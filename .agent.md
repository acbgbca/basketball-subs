# Basketball Subs - Agent Reference

## Overview
PWA for basketball coaches to track player substitutions, fouls, and game time. React/TypeScript with offline IndexedDB storage.

## Tech Stack
- **Frontend**: React 19, TypeScript, React-Bootstrap, HashRouter
- **Storage**: IndexedDB via `idb`
- **Testing**: Jest (unit), Playwright (e2e)
- **Build**: Webpack, deployed to GitHub Pages

## Key Data Types
```typescript
Player: { id, name, number }
Team: { id, name, players[] }
Game: { id, date, team, opponent, players[], periods[], activePlayers[], currentPeriod, isRunning }
Period: { id, periodNumber, length: 10|20, substitutions[], fouls[], subEvents[] }
Substitution: { id, player, timeInEvent, timeOutEvent, secondsPlayed, periodId }
SubstitutionEvent: { id, eventTime, periodId, subbedIn[], playersOut[] }
Foul: { id, player, periodId, timeRemaining }
```

## Core Services
- **`src/services/db.ts`**: IndexedDB operations (getTeams, addTeam, getGames, updateGame, etc.)
- **`src/services/gameService.ts`**: Game logic (calculatePlayerMinutes, subModalSubmit, endPeriod, addFoul, editSubstitution)

## Key Components
- **`GameView.tsx`**: Main game interface with timer, substitutions, fouls
- **`GameHeader.tsx`**: Clock controls, period info
- **`PlayerTable.tsx`**: Player stats (time, fouls, status)
- **`SubstitutionTable.tsx`**: Sub history with edit/delete
- **Modals**: SubstitutionModal, FoulModal, EndPeriodModal, EditSubstitutionModal

## Business Rules
- Max 5 players on court
- Substitution events can involve multiple players
- Editing subs updates all related records and active players
- Timer precision with refs/timestamps

## Routes (HashRouter)
- `/` → GameList, `/teams` → TeamList, `/games/new` → GameForm, `/games/:id` → GameView

## Development Patterns
- Business logic in services, not components
- TypeScript strict mode
- React-Bootstrap for UI
- UUID for all IDs
- Comprehensive testing (unit + e2e with page objects)

## Testing
- `npm test` (Jest), `npm run test:e2e` (Playwright)
- E2E helpers in `e2e/pages/` (Teams.ts, SetupGame.ts, RunGame.ts)